openapi: 3.0.0
info:
  title: Huefy SDK API
  version: 1.0.0
  description: |
    Huefy SDK API for sending templated emails via multiple email providers.
    
    ## Authentication
    All endpoints require API key authentication via the `X-API-Key` header.
    
    ## Providers
    Huefy supports multiple email providers with SES as the default:
    - `ses` (Amazon SES) - Default provider
    - `sendgrid` (SendGrid)
    - `mailgun` (Mailgun) 
    - `mailchimp` (Mailchimp)
    
    ## Rate Limits
    - 1000 requests per minute per API key
    - 10,000 emails per hour per API key
    
  contact:
    name: Huefy Support
    email: support@huefy.com
    url: https://docs.huefy.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api/v1/sdk
    description: Local development server
  - url: https://api.huefy.com/api/v1/sdk
    description: Production server

security:
  - ApiKeyAuth: []

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication. Get yours from the Huefy dashboard.

  schemas:
    SendEmailRequest:
      type: object
      required:
        - templateKey
        - data
        - recipient
      properties:
        templateKey:
          type: string
          description: The unique identifier for the email template
          example: "welcome-email"
          minLength: 1
          maxLength: 100
        templateVersion:
          type: integer
          description: Optional specific version of the template to use
          example: 1
        data:
          type: object
          additionalProperties: true
          description: Template variables as key-value pairs
          example:
            name: "John Doe"
            company: "Acme Corp"
            verificationUrl: "https://app.example.com/verify/abc123"
        recipient:
          $ref: '#/components/schemas/EmailRecipient'
        fromEmail:
          type: string
          format: email
          description: Optional custom sender email address
          example: "noreply@yourcompany.com"
        fromName:
          type: string
          description: Optional sender display name
          example: "Your Company"
        replyTo:
          type: string
          format: email
          description: Optional reply-to email address
          example: "support@yourcompany.com"
        providerType:
          type: string
          enum: [ses, sendgrid, mailgun, mailchimp]
          description: |
            Email provider to use for sending (optional).
            If not specified, defaults to 'ses' (Amazon SES).
          example: "sendgrid"
        correlationId:
          type: string
          description: Optional correlation ID for request tracking
          example: "req_1234567890abcdef"
        metadata:
          type: object
          additionalProperties: true
          description: Optional metadata for the email
          example:
            campaign: "onboarding"
            source: "website"

    EmailRecipient:
      type: object
      required:
        - email
        - type
      properties:
        email:
          type: string
          format: email
          description: The recipient's email address
          example: "john@example.com"
          maxLength: 254
        type:
          type: string
          enum: [to, cc, bcc]
          default: to
          description: Type of recipient
          example: "to"
        data:
          type: object
          additionalProperties: true
          description: Recipient-specific template data
          example:
            firstName: "John"

    SendEmailResponse:
      type: object
      required:
        - success
        - data
        - correlationId
      properties:
        success:
          type: boolean
          description: Whether the email was sent successfully
          example: true
        data:
          $ref: '#/components/schemas/EmailResponseData'
        correlationId:
          type: string
          description: Correlation ID for request tracking
          example: "req_1234567890abcdef"

    EmailResponseData:
      type: object
      required:
        - emailId
        - status
        - recipients
      properties:
        emailId:
          type: string
          description: Unique identifier for the email
          example: "email_1234567890abcdef"
        status:
          type: string
          description: Status of the email
          example: "sent"
        recipients:
          type: array
          items:
            $ref: '#/components/schemas/RecipientStatus'
          description: Status of each recipient
        scheduledAt:
          type: string
          format: date-time
          description: When the email was scheduled (if applicable)
          example: "2024-01-01T12:00:00Z"
        sentAt:
          type: string
          format: date-time
          description: When the email was sent
          example: "2024-01-01T12:00:00Z"

    RecipientStatus:
      type: object
      required:
        - email
        - status
      properties:
        email:
          type: string
          format: email
          description: Recipient email address
          example: "john@example.com"
        status:
          type: string
          description: Status for this recipient
          example: "sent"
        messageId:
          type: string
          description: Provider-specific message ID
          example: "msg_1234567890abcdef"
        error:
          type: string
          description: Error message if delivery failed
          example: "Invalid email address"
        sentAt:
          type: string
          format: date-time
          description: When the email was sent to this recipient
          example: "2024-01-01T12:00:00Z"

    ErrorResponse:
      type: object
      required:
        - success
        - error
        - correlationId
      properties:
        success:
          type: boolean
          description: Always false for error responses
          example: false
        error:
          $ref: '#/components/schemas/ApiError'
        correlationId:
          type: string
          description: Correlation ID for request tracking
          example: "req_1234567890abcdef"

    ApiError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Machine-readable error code
          example: "TEMPLATE_NOT_FOUND"
          enum:
            - API_KEY_REQUIRED
            - API_KEY_INVALID
            - API_KEY_EXPIRED
            - API_KEY_SUSPENDED
            - TEMPLATE_NOT_FOUND
            - TEMPLATE_NOT_PUBLISHED
            - INVALID_TEMPLATE_DATA
            - INVALID_EMAIL
            - EMAIL_SUPPRESSED
            - PROVIDER_UNAVAILABLE
            - SEND_FAILED
            - INVALID_REQUEST
            - RATE_LIMIT_EXCEEDED
            - INTERNAL_ERROR
        message:
          type: string
          description: Human-readable error message
          example: "Template 'welcome-email' not found"
        details:
          type: object
          description: Additional error details
          additionalProperties: true
          example:
            templateKey: "welcome-email"
            availableTemplates: ["onboarding", "welcome"]
        timestamp:
          type: string
          format: date-time
          description: When the error occurred
          example: "2024-01-01T12:00:00Z"

    HealthResponse:
      type: object
      required:
        - success
        - data
        - correlationId
      properties:
        success:
          type: boolean
          description: Always true for health responses
          example: true
        data:
          $ref: '#/components/schemas/HealthData'
        correlationId:
          type: string
          description: Correlation ID for request tracking
          example: "health_001"

    HealthData:
      type: object
      required:
        - status
        - timestamp
        - version
      properties:
        status:
          type: string
          description: Health status of the service
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          description: Current server timestamp
          example: "2024-01-01T12:00:00Z"
        version:
          type: string
          description: API version
          example: "1.0.0"

    ValidationError:
      type: object
      required:
        - field
        - message
      properties:
        field:
          type: string
          description: The field that failed validation
          example: "recipient"
        message:
          type: string
          description: Validation error message
          example: "Must be a valid email address"
        code:
          type: string
          description: Validation error code
          example: "INVALID_EMAIL"

paths:
  /emails/send:
    post:
      summary: Send an email using a template
      description: |
        Sends an email using a predefined template with variable substitution.
        
        ## Template Variables
        The `data` object contains key-value pairs that will be substituted into the template.
        Variable names in templates use double curly braces: `{{variable_name}}`
        
        ## Provider Selection
        If no provider is specified, Amazon SES will be used by default.
        You can override this by setting the `provider_type` field.
        
        ## Rate Limiting
        This endpoint is rate limited to 1000 requests per minute per API key.
        
      operationId: sendEmail
      tags:
        - Email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendEmailRequest'
            examples:
              basic_example:
                summary: Basic welcome email
                description: Send a welcome email with default SES provider
                value:
                  templateKey: "welcome-email"
                  data:
                    name: "John Doe"
                    company: "Acme Corp"
                  recipient:
                    email: "john@example.com"
                    type: "to"
                  correlationId: "req_welcome_001"
              
              custom_provider:
                summary: Email with custom provider
                description: Send an email using SendGrid instead of default SES
                value:
                  templateKey: "newsletter"
                  data:
                    name: "Jane Smith"
                    unsubscribe_url: "https://app.example.com/unsubscribe/xyz789"
                  recipient:
                    email: "jane@example.com"
                    type: "to"
                  providerType: "sendgrid"
                  correlationId: "req_newsletter_001"
              
              password_reset:
                summary: Password reset email
                description: Send a password reset email with verification link
                value:
                  templateKey: "password-reset"
                  data:
                    name: "Bob Wilson"
                    reset_url: "https://app.example.com/reset/token123"
                    expires_at: "2024-01-10 15:30:00 UTC"
                  recipient:
                    email: "bob@example.com"
                    type: "to"
                  providerType: "mailgun"
                  fromEmail: "noreply@yourcompany.com"
                  fromName: "Your Company"
                  correlationId: "req_reset_001"

      responses:
        '200':
          description: Email sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SendEmailResponse'
              examples:
                success_response:
                  summary: Successful email send
                  value:
                    success: true
                    data:
                      emailId: "email_1234567890abcdef"
                      status: "sent"
                      recipients:
                        - email: "john@example.com"
                          status: "sent"
                          messageId: "msg_1234567890abcdef"
                          sentAt: "2024-01-01T12:00:00Z"
                      sentAt: "2024-01-01T12:00:00Z"
                    correlationId: "req_welcome_001"

        '400':
          description: Bad request - validation error or invalid data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                template_not_found:
                  summary: Template not found
                  value:
                    success: false
                    error:
                      code: "TEMPLATE_NOT_FOUND"
                      message: "Template 'invalid-template' not found"
                      details:
                        templateKey: "invalid-template"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_error_001"
                
                invalid_email:
                  summary: Invalid email address
                  value:
                    success: false
                    error:
                      code: "INVALID_EMAIL"
                      message: "Invalid recipient email address"
                      details:
                        recipient: "invalid-email"
                        field: "recipient.email"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_error_002"
                
                missing_template_data:
                  summary: Missing template variables
                  value:
                    success: false
                    error:
                      code: "INVALID_TEMPLATE_DATA"
                      message: "Template requires variables that were not provided"
                      details:
                        templateKey: "welcome-email"
                        missingVariables: ["name", "company"]
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_error_003"

        '401':
          description: Unauthorized - invalid or missing API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_api_key:
                  summary: Invalid API key
                  value:
                    success: false
                    error:
                      code: "API_KEY_INVALID"
                      message: "Invalid API key provided"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_auth_001"
                
                missing_api_key:
                  summary: Missing API key
                  value:
                    success: false
                    error:
                      code: "API_KEY_REQUIRED"
                      message: "API key is required"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_auth_002"

        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                rate_limit:
                  summary: Rate limit exceeded
                  value:
                    success: false
                    error:
                      code: "RATE_LIMIT_EXCEEDED"
                      message: "Rate limit exceeded. Maximum 1000 requests per minute."
                      details:
                        limit: 1000
                        window: "1 minute"
                        resetAt: "2024-01-09T10:31:00Z"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_rate_001"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                provider_error:
                  summary: Email provider error
                  value:
                    success: false
                    error:
                      code: "PROVIDER_UNAVAILABLE"
                      message: "Failed to send email via provider"
                      details:
                        provider: "ses"
                        providerMessage: "Invalid sender domain"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_provider_001"
                
                internal_error:
                  summary: Internal server error
                  value:
                    success: false
                    error:
                      code: "INTERNAL_ERROR"
                      message: "An internal error occurred"
                      timestamp: "2024-01-01T12:00:00Z"
                    correlationId: "req_internal_001"

  /health:
    get:
      summary: Health check endpoint
      description: Returns the health status of the API
      operationId: healthCheck
      tags:
        - Health
      security: []  # No authentication required
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                healthy:
                  summary: Service is healthy
                  value:
                    success: true
                    data:
                      status: "healthy"
                      timestamp: "2024-01-01T12:00:00Z"
                      version: "1.0.0"
                    correlationId: "health_001"

tags:
  - name: Email
    description: Email sending operations
  - name: Health
    description: Health check operations

x-code-samples:
  - lang: JavaScript
    source: |
      import { HuefyClient } from '@huefy/sdk';

      const huefy = new HuefyClient({
        apiKey: 'your-api-key'
      });

      const result = await huefy.sendEmail('welcome-email', {
        name: 'John Doe',
        company: 'Acme Corp'
      }, 'john@example.com');

      console.log('Email sent:', result.messageId);

  - lang: Go
    source: |
      package main

      import (
          "fmt"
          "github.com/huefy/huefy-sdk-go"
      )

      func main() {
          client := huefy.NewClient("your-api-key")
          
          data := map[string]string{
              "name": "John Doe",
              "company": "Acme Corp",
          }
          
          resp, err := client.SendEmail("welcome-email", data, "john@example.com")
          if err != nil {
              panic(err)
          }
          
          fmt.Printf("Email sent: %s\n", resp.MessageID)
      }

  - lang: Python
    source: |
      from huefy import HuefyClient

      huefy = HuefyClient(api_key="your-api-key")

      result = huefy.send_email(
          template_key="welcome-email",
          data={
              "name": "John Doe",
              "company": "Acme Corp"
          },
          recipient="john@example.com"
      )

      print(f"Email sent: {result['message_id']}")

  - lang: Java
    source: |
      import com.huefy.HuefyClient;
      import java.util.Map;

      public class Example {
          public static void main(String[] args) {
              HuefyClient huefy = new HuefyClient("your-api-key");
              
              Map<String, String> data = Map.of(
                  "name", "John Doe",
                  "company", "Acme Corp"
              );
              
              String messageId = huefy.sendEmail("welcome-email", data, "john@example.com");
              System.out.println("Email sent: " + messageId);
          }
      }

  - lang: PHP
    source: |
      <?php
      use Huefy\SDK\HuefyClient;

      $huefy = new HuefyClient('your-api-key');

      $result = $huefy->sendEmail('welcome-email', [
          'name' => 'John Doe',
          'company' => 'Acme Corp'
      ], 'john@example.com');

      echo "Email sent: " . $result['message_id'];